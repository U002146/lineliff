<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é ç´„å«è»Šæœå‹™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input, select, textarea { font-size: 16px !important; }
        .hidden { display: none !important; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-800">

    <!-- Loading -->
    <div id="loading-overlay" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="loader mb-4 w-10 h-10 border-4"></div>
        <p id="loading-text" class="text-gray-500 font-bold">ç³»çµ±é€£ç·šä¸­...</p>
    </div>

    <div id="app" class="hidden min-h-screen flex justify-center p-0 md:p-4">
        <div class="w-full max-w-md bg-white shadow-xl rounded-none md:rounded-3xl overflow-hidden min-h-screen md:min-h-0 flex flex-col">
            
            <!-- Header -->
            <header class="bg-blue-600 text-white p-6 pb-8 rounded-b-[2rem] shadow-lg z-10">
                <div class="text-center">
                    <h1 class="text-2xl font-bold">ğŸš• é ç´„å«è»Š</h1>
                    <p id="user-display" class="text-blue-100 text-sm mt-1">è¼‰å…¥ä½¿ç”¨è€…...</p>
                </div>
            </header>

            <!-- Form -->
            <div class="flex-1 overflow-y-auto p-6 -mt-4 relative z-20">
                <form id="booking-form" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 space-y-4">
                    <input type="hidden" id="name">
                    
                    <div>
                        <label class="block font-bold text-gray-700 mb-1">ğŸ“ è¯çµ¡é›»è©±</label>
                        <input type="tel" id="phone" required placeholder="09xx-xxx-xxx" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-blue-500 outline-none">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block font-bold text-gray-700 mb-1">ğŸ“… æ—¥æœŸ</label>
                            <input type="date" id="date" required class="w-full p-3 bg-white border border-gray-200 rounded-xl">
                        </div>
                        <div>
                            <label class="block font-bold text-gray-700 mb-1">ğŸ•’ æ™‚é–“</label>
                            <input type="time" id="time" required class="w-full p-3 bg-white border border-gray-200 rounded-xl text-center">
                        </div>
                    </div>

                    <div class="border-l-4 border-gray-100 pl-4 space-y-3 py-2">
                        <div>
                            <label class="block text-sm font-bold text-green-600 mb-1">ğŸŸ¢ ä¸Šè»Šåœ°é»</label>
                            <input type="text" id="pickup" required placeholder="è«‹è¼¸å…¥ä¸Šè»Šè™•" class="w-full p-3 border border-gray-200 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-red-600 mb-1">ğŸ”´ ä¸‹è»Šåœ°é»</label>
                            <input type="text" id="dropoff" required placeholder="è«‹è¼¸å…¥ç›®çš„åœ°" class="w-full p-3 border border-gray-200 rounded-xl">
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="p-4 bg-white border-t border-gray-100 z-30">
                <button id="submitBtn" onclick="submitBooking()" class="w-full py-4 rounded-xl bg-green-500 text-white text-xl font-bold shadow-lg active:scale-95 transition-transform flex justify-center items-center">
                    ç¢ºèªå«è»Š
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        const MY_LIFF_ID = "2008907691-v0O7W8d3"; // ä½ çš„ ID
        // ==========================================

        const dom = {
            loading: document.getElementById('loading-overlay'),
            app: document.getElementById('app'),
            userDisplay: document.getElementById('user-display'),
            btn: document.getElementById('submitBtn'),
            inputs: {
                name: document.getElementById('name'),
                phone: document.getElementById('phone'),
                date: document.getElementById('date'),
                time: document.getElementById('time'),
                pickup: document.getElementById('pickup'),
                dropoff: document.getElementById('dropoff')
            }
        };

        // è¼‰å…¥ SDK (ç©©å®šç‰ˆ)
        function loadSDK(callback) {
            const script = document.createElement('script');
            script.src = 'https://static.line-scdn.net/liff/edge/2/sdk.js';
            script.onload = callback;
            document.head.appendChild(script);
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            // è¨­å®šé è¨­æ™‚é–“
            const now = new Date();
            dom.inputs.date.valueAsDate = now;
            now.setHours(now.getHours() + 1);
            dom.inputs.time.value = now.toTimeString().substring(0,5);

            loadSDK(() => {
                liff.init({ liffId: MY_LIFF_ID }).then(() => {
                    if (!liff.isLoggedIn()) {
                        liff.login();
                        return;
                    }
                    liff.getProfile().then(profile => {
                        dom.userDisplay.innerText = `Hi, ${profile.displayName}`;
                        dom.inputs.name.value = profile.displayName;
                        dom.loading.classList.add('hidden');
                        dom.app.classList.remove('hidden');
                    });
                });
            });
        };

        // é€å‡ºè¡¨å–®
        async function submitBooking() {
            const form = document.getElementById('booking-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            dom.btn.disabled = true;
            dom.btn.innerHTML = `<div class="loader mr-2"></div> è™•ç†ä¸­...`;
            dom.btn.classList.replace('bg-green-500', 'bg-gray-400');

            const data = {
                pickup: dom.inputs.pickup.value,
                dropoff: dom.inputs.dropoff.value,
                date: dom.inputs.date.value,
                time: dom.inputs.time.value,
                name: dom.inputs.name.value,
                phone: dom.inputs.phone.value
            };

            const msgText = `ğŸš• æ–°å¢å«è»Š\n----------------\nğŸ‘¤ ä¹˜å®¢ï¼š${data.name}\nğŸ“ é›»è©±ï¼š${data.phone}\nğŸ“… æ™‚é–“ï¼š${data.date} ${data.time}\nğŸŸ¢ ä¸Šè»Šï¼š${data.pickup}\nğŸ”´ ä¸‹è»Šï¼š${data.dropoff}`;

            try {
                // 1. å…ˆå˜—è©¦ç”¨ LIFF ç™¼é€è¨Šæ¯ (æœ€å¿«)
                if (liff.isInClient()) {
                    await liff.sendMessages([{ type: 'text', text: msgText }]);
                }

                // 2. (æœªä¾†åŠŸèƒ½) é€™è£¡å¯ä»¥å‘¼å« GAS å¯«å…¥è©¦ç®—è¡¨
                // await fetch('GAS_URL', { ... });

                alert("âœ… é ç´„æˆåŠŸï¼\nå¸æ©Ÿå°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹«");
                liff.closeWindow();

            } catch (err) {
                alert("âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message);
                dom.btn.disabled = false;
                dom.btn.innerHTML = "ç¢ºèªå«è»Š";
                dom.btn.classList.replace('bg-gray-400', 'bg-green-500');
            }
        }
    </script>
</body>
</html>
